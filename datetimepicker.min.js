"use strict";angular.module("angular-datetimepicker-custom",[]).directive("datetimepicker",[function(){function e(e,t,a,o){var n={date:!1,dateFormatted:!1};(void 0===t||!t&&0!==t)&&(t=e.zone()),(void 0===a||!a&&0!==a)&&(a=moment().zone());var i=a-t;e=i>-1?e.subtract("minutes",i):e.add("minutes",i);var d=e.format("YYYY-MM-DD HH:mm:ss"),r=a;0>r&&(r=-1*r);var l=Math.floor(r/60).toString();1==l.length&&(l="0"+l);var m=(r%60).toString();1==m.length&&(m="0"+m);var p="+";a>=0&&(p="-");var s=p+l+":"+m;return d+=""+s,n.date=moment(d,"YYYY-MM-DD HH:mm:ssZ"),void 0!==o.format&&(n.dateFormatted=n.date.format(o.format)),n}return{restrict:"A",scope:{ngModel:"=",validate:"&",ngChange:"&?",opts:"=",ngClick:"&?"},replace:!0,template:function(e,t){var a="pikaday";"undefined"!=typeof forge&&forge&&void 0!==forge&&(a="forge"),t.placeholder||(t.placeholder="Choose a date/time");var o="";t["class"]&&(o+=t["class"]);var n="",i=["datetimepicker","ngModel","label","type","placeholder","opts","name","validate","ngChange","ngClick"];angular.forEach(t,function(e,a){"$"!==a.charAt(0)&&-1===i.indexOf(a)&&(n+=t.$attr[a],t[a]&&(n+="="+t[a]),n+=" ")});var d="<div class='"+o+"'>";return"pikaday"==a?(d+="<input type='datetime' placeholder='"+t.placeholder+"' "+n+" ",t.ngClick&&(d+="ng-click='ngClick()' "),d+="/>"):"forge"==a&&(d+="<input type='datetime-local' placeholder='"+t.placeholder+"' "+n+" ",t.ngClick&&(d+="ng-click='ngClick()' "),d+="/>"),d+="</div>",t.type=a,d},link:function(t,a,o){function n(e){if(t.ngModel=e,"forge"==o.type){var a=moment(t.ngModel,t.opts.formatModel),n=a.format(m);document.getElementById(o.id).value=n}else{var i="YYYY-MM-DD",d="HH:mm:ss",r=moment(t.ngModel,t.opts.formatModel).format(i+" "+d+"Z"),l=r,p="";r.indexOf(" ")>-1&&(l=r.slice(0,r.indexOf(" ")),p=r.slice(r.indexOf(" ")+1,r.length)),c.setMoment(moment(l,i)),c.setTimeMoment(moment(p,d))}}function i(e){if(!p){var a=t.ngModel;d(e,{}),void 0!==t.validate&&void 0!==t.validate()&&"function"==typeof t.validate()?t.validate()(e,{opts:t.opts},function(i){if(i)r(e,{});else{var l=!0;t.opts.revertOnInvalid&&a&&(l=!1,n(a)),l&&(e="",document.getElementById(o.id).value="",d(e,{}))}}):r(e,{}),t.$$phase||t.$apply()}}function d(e){t.ngModel=e,t.$$phase||t.$apply()}function r(e){void 0!==t.ngChange&&void 0!==t.ngChange()&&"function"==typeof t.ngChange()&&t.ngChange()(e,{opts:t.opts})}var l={opts:{formatModel:"YYYY-MM-DD HH:mm:ssZ",formatDisplay:"YYYY-MM-DD HH:mm:ssZ",revertOnInvalid:!1}};t.opts=angular.extend(l.opts,t.opts),void 0!==t.opts.id?o.id=t.opts.id:void 0===o.id&&(o.id="jrgDatetimepicker"+Math.random().toString(36).substring(7)),a.find("input").attr("id",o.id);var m,p=!0;if("forge"==o.type)m="YYYY-MM-DDTHH:mm:ss",forge.ui.enhanceInput("#"+o.id),t.ngModel&&n(t.ngModel),a.find("input").bind("blur",function(){var a,n=document.getElementById(o.id).value,d=!1;"object"==typeof n?a=moment(n):"string"==typeof n&&(a=moment(n,"YYYY-MM-DD HH:mm"),n.indexOf("Z")>-1&&(d=0));var r="YYYY-MM-DD HH:mm:ssZ",l=e(a,d,!1,{format:r}),p=moment(l.dateFormatted,r).format(t.opts.formatModel),s=l.date.format(m);document.getElementById(o.id).value=s,i(p)});else{var s={field:document.getElementById(o.id),onSelect:function(){var e=this.getMoment().format(t.opts.formatModel);i(e)},minDate:new Date("2000-01-01"),maxDate:new Date("2020-12-31"),yearRange:[2e3,2020]};void 0===t.opts.pikaday&&(t.opts.pikaday={}),t.opts.pikaday.format=t.opts.formatDisplay;var f=angular.extend(s,t.opts.pikaday),c=new Pikaday(f);t.ngModel&&n(t.ngModel)}p=!1,t.$on("datetimepickerUpdateVal",function(e,a){void 0!==t.opts.id&&void 0!==a.instId&&t.opts.id==a.instId&&n(a.val)})}}}]);